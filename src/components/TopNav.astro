---
import { getLangFromUrl, useTranslations } from "../i18n/utils";

import BaseButton from "./BaseButton.vue";
import BaseMenu from "./BaseMenu.astro";
import ThemeSelector from "./ThemeSelector.astro";
import SocialIconsBase from "./SocialIconsBase.vue";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const { links, themes } = Astro.props;
---

<nav class="bg-primary">
  <div class="container mx-auto flex justify-center z-50 px-3">
    <div class="flex items-center">
      <img
        class="w-16 h-full"
        src="logo-extra-compressed.png"
        alt="Logo of the portfolio"
      />
      <h4 class="text-3xl ml-5">José García</h4>
    </div>

    <ul class="flex items-center text-xl mx-auto">
      {
        links.map((link) => (
          <li class="px-3 relative mx-0 transition-colors transition-200 navbar__link">
            <a href={link.link} onclick={`scrollToPosition(${link.link})`}>
              {t(link.text)}
            </a>
          </li>
        ))
      }
    </ul>
    <div class="flex items-center text-2xl">
      <div id="change-language-button">
        <BaseButton
          client:only
          title="Translate"
          class="relative mx-0 transition-colors transition-200 navbar__link"
          icon
        >
          <SocialIconsBase icon="mdiTranslate" />
        </BaseButton>
      </div>
      <BaseMenu bottom="initial" top="3rem">
        <div slot="activator">
          <BaseButton
            title="Theme changer"
            class="relative mx-0 transition-colors transition-200 navbar__link"
            icon
            v-bind="on"
          >
            <SocialIconsBase icon="mdiInvertColors" />
          </BaseButton>
        </div>
        <ThemeSelector
          id="theme-selector"
          themes={themes}
          oninput="saveTheme"
        />
      </BaseMenu>
    </div>
  </div>
</nav>

<script>
  import { scrollToPosition } from "../utils/scrollToPosition";
  import { setTheme } from "../utils/themeHelper";
  import { changeLanguage } from "@/i18n/utils";

  const changeLanguageButton = document.getElementById(
    "change-language-button",
  );

  changeLanguageButton.addEventListener("click", changeLanguage);

  window.addEventListener("load", () => {
    let theme = localStorage.getItem("theme") ?? "default";
  });

  const saveTheme = (value) => {
    setTheme(value);
  };
</script>

<style>
  .navbar__link {
    color: var(--text-color-primary);
  }

  .navbar__link:hover {
    color: var(--text-color-secondary);
  }
</style>
